<main>
  <div class='max-w-screen-lg px-3 mx-auto mt-8'>
    <section class='mb-4'>
      <h2 class="mb-4 text-xl">
        你好
        <%= current_manager.name %>
      </h2>
      <div>
        <span class='px-6 py-2 mr-2 cursor-pointer major-btn'>
          <i class="fa-solid fa-plus">
            <%= link_to " 新增餐廳", new_backstage_manager_restaurant_path(current_manager.id) %>
          </i>
        </span>
        <span class='px-6 py-2 mr-2 cursor-pointer major-btn'>
         <i class="fa-solid fa-gear"></i>
        </span>
        <span class='px-6 py-2 mr-2 cursor-pointer major-btn'>
          <a href="/">
            <i class="fa-solid fa-house"></i>
          </a>
        </span>
      </div>
    </section>

    <section class='grid w-full grid-cols-2 gap-5 md:my-4'>
      <% @restaurants.each do |restaurant| %>
        <div class='flex flex-col border rounded shadow-lg '>
        
          <div class="h-60 md:h-80">
            <%= image_tag restaurant.images[0], class: "object-cover w-full h-full" %>
          </div>

          <div class="mt-5">
            <% restaurant.tags.each do |tag| %>
              <span class= "inline-block px-5 m-1 text-base bg-gray-100 border cursor-pointer y-1 hover:bg-major hover:text-white rounded-xl">
                <%= tag.name %>
              </span>
            <% end %>
          </div>

          <div class='flex flex-col my-4 md:flex-row md:gap-4'>
            <div class='grid w-full grid-cols-2 gap-4 p-4 mb-4 ml-2 text-center border rounded md:w-1/2 md:mb-0'>
              <span>
                <p class='text-3xl text-major'>
                  <%= restaurant.reservations.select{|reservation| reservation.arrival_date == Date.today}.size %>
                </p>
                <p>今日組數</p>
              </span>
              <span>
                <p class='text-3xl text-major'>
                  0
                </p>
                <p>以報到</p>
              </span>
              <span>
                <p class='text-3xl text-major'>
                  <%= restaurant.seats.size %>
                </p>
                <p>同時<br/>容納上限</p>
              </span>
              <div>
                <% opening_time = restaurant.opening_times.reduce([]){|arr, opening_time| arr << (opening_time.opening_time.strftime('%R')..opening_time.closed_time.strftime('%R'))} %>  
                <% opening_time = opening_time.select{|time_range| time_range.include?(Time.current.strftime('%R'))} %>
                <% if opening_time.size > 0 %>
                  <span class='text-2xl text-green-500'>營業中</span>
                <% else %>
                  <span class='text-2xl text-red-500'>已打烊</span>
                <% end %>
                <p>餐廳<br/>營業狀況</p> 
              </div>
            </div>
            
            <div>
              <h2 class='mb-4 text-xl font-bold'>
                <%= restaurant.title %><br/>                
              </h2>
              <h3 class="text-lg text-gray-500">
                餐廳資訊 - <%= restaurant.branch %>
              </h3>
              <div class="mt-3 text-sm text-gray-500 ">
                <i class="fa-solid fa-phone"></i>
                <span class="ml-2 text-sm text-gray-500">
                  <%= restaurant.tel %>
                </span>
              </div>
              <div class='mb-4 text-sm text-gray-500'>
                <i class="fa-solid fa-location-dot"></i>
                <span class="ml-2 text-sm text-gray-500">
                  <%= restaurant.address %>
                </span>
              </div>
              <div class='flex'>
                <%= link_to '管理訂單', backstage_restaurant_path(restaurant), class: 'major-btn cursor-pointer px-4 py-2 mr-4'%>
                <%= link_to "編輯餐廳資訊", edit_backstage_restaurant_path(restaurant), class: "px-4 py-2 text-major border-2 border-major rounded text-sm p-1 hover:bg-major hover:text-white" %>
              </div>

            </div>
          </div>
          
        </div>
      <% end %> 
    </section>
  </div>  
</main>

      