<main class="max-w-screen-lg mx-auto">
  <section>
    <div class="swiper mySwiperTop" data-controller="swiper-carousel-top">
      <div class="swiper-wrapper">
        <% @restaurant.images.each do |image| %>
          <div class="swiper-slide">
            <%= image_tag (image.url),class:"object-cover" %>
          </div>
        <% end %>
      </div>
      <div class="swiper-button-next swiper-button-next-top"></div>
      <div class="swiper-button-prev swiper-button-prev-top"></div>
      <div class="swiper-pagination swiper-pagination-top"></div>
    </div> 

    <div>
      <div class="py-8 space-y-2.5 border-b-2">  
        <h1 class="text-4xl font-bold">
          <%= @restaurant.title %>
          <%= @restaurant.branch %>
        </h1>
        <p class="text-gray-500 "><%= @restaurant.address %></p>
        <div>
          <i class="fa-regular fa-phone-office"></i>
          <%= @restaurant.tel %>
          <i class="fa-regular fa-map">地圖</i>
        </div>
      </div>
      <div class="py-8 space-y-2.5 border-b-2">
        <%= @content %>
      </div>
    </div>
  </section>
  
  <section class='pb-6 mx-2 mb-6 border-b-2 lg:mx-0'>
    <div>
      <%= form_with url: reserve_restaurant_path(@restaurant), method: "get", data: {
        controller: 'restaurant-reservation'
      } do |f| %>
        <div>
          <div class='gap-4 md:grid grid-cols-1-2'>
            <div>
              <h4 class='reservation-font'>用餐人數</h4>
              <div class='flex gap-2'>
                <%= f.select :adult_quantity, [['1位大人', 1], ['2位大人', 2], ['3位大人', 3], ['4位大人', 4], ['5位大人', 5]],
                  {},
                  {class: 'input-border-click w-full py-1 px-2',
                    data: {restaurant_reservation_target: 'adult',
                            action: 'change->restaurant-reservation#fetchOccupied',
                            id: @restaurant.id    
                    }
                  }%>
                <%= f.select :child_quantity, [['0位小孩', 0], ['1位小孩', 1], ['2位小孩', 2], [' 3位小孩', 3], ['4位小孩', 4], [' 5位小孩', 5]],
                  {},
                  {class: 'input-border-click w-full py-1 px-2',
                    data: {restaurant_reservation_target: 'child',
                            action: 'change->restaurant-reservation#fetchOccupied',
                            id: @restaurant.id   
                    }
                  } %>
              </div>
            </div>
            <div>
              <% date_range = RestaurantsHelper::DateRange.new([]) %>
              <% date_range.set_end_day(@restaurant.period_of_reservation) %>
              <% date_range.reservation_range_date(Date.yesterday) %>

              <h4 class='reservation-font'>用餐日期</h4>
              <div class='grid grid-cols-5 gap-3 md:grid-cols-7'>

                <% date_range.date_list.each do |date| %>
                  <button class='w-full h-full py-1 gray-btn'
                          data-action='click->restaurant-reservation#getDate'
                          data-restaurant-reservation-target='date'
                          data-id='<%=@restaurant.id%>'
                          value='<%= date %>'
                          >
                    <%= date %>
                  </button>
                <% end %>
                <input type="hidden" name="arrival_date" data-restaurant-reservation-target='dateInput'>
              </div>
            </div>
          </div>
          
          <div>
            <% time_range = RestaurantsHelper::TimeRange.new([], @restaurant.intreval_time) %>
            <% time_range.intreval_time(@restaurant.start_time - 30.minutes, @restaurant.end_time) %>
            <h4 class='reservation-font'>用餐時間</h4>

            <div class='hidden text-center border rounded' data-restaurant-reservation-target='notice'>
              <div class='text-red-500 '>座位已滿</div>
            </div>
            <div class='grid grid-cols-7 gap-3'  data-restaurant-reservation-target='timeBtn'>
              <% time_range.time_points.each do |time_point| %>
                <button class='py-1 disabled-btn'
                        data-action='click->restaurant-reservation#getTime'
                        data-restaurant-reservation-target='time'
                        value='<%= time_point %>'
                        data-id='<%=@restaurant.id%>'
                        disabled>
                  <%= time_point %>
                </button>
              <% end %>
              <input type="hidden" name="arrival_time" data-restaurant-reservation-target='timeInput'>
            </div>
          </div>

          <div>
            <h4 class='reservation-font'>選擇座位</h4>
            <div class='grid grid-cols-7 gap-3' data-restaurant-reservation-target='seatBtn'>
              <% @seats.each do |seat| %>
                <button class='py-1 disabled-btn'
                        data-action='click->restaurant-reservation#getSeat'
                        data-restaurant-reservation-target='seat'
                        value='<%= seat.id %>'
                        disabled>
                  <%= seat.kind %>
                </button>
              <% end %>
              <input type="hidden" name="seat_id" data-restaurant-reservation-target='seatInput'>
            </div>  
          </div>
        </div> 
          
      <div class="fixed z-40 w-full px-2 lg:px-0 max-w-1140 bottom-1 ">
        <div class= "w-full mx-auto">
          <%= f.submit '訂位，下一步填寫資料', 
                        class:'disabled-btn w-full py-2',
                        disabled: true,
                        data: {
                          restaurant_reservation_target: 'submit'
                        }%>
        </div>
      </div>
      <% end %>
    </div>
  </section>

  <section>
    <div class='grid-cols-2 pb-6 mx-2 mb-6 border-b-2 md:grid lg:mx-0 md:gap-4'>
      <div class='mb-6'>
        <iframe
        class='w-full h-full border-none'
        loading="lazy" 
        referrerpolicy="no-referrer-when-downgrade"
        src="https://www.google.com/maps/embed/v1/place?key=<%= ENV['GOOGLE_MAP_KEY']%>
          &q=<%= @restaurant.address%>">
        </iframe>
      </div>
      <div class='px-4'>
        <div class='pb-2 mb-2 border-b-2'>
          <p class='mb-2'>位置</p>
          <p class='text-gray-600'>
            <%= @restaurant.address%>
          </p>
        </div>
        <div class='pb-2 mb-2 border-b-2'>
          <p class='mb-2'>電話</p>
          <p class='text-gray-600'>
            <%= @restaurant.tel%>
            </p>
        </div>
        <div class='pb-2 mb-2 border-b-2'>
          <p class='mb-2'>營業時間</p>
          <p class='text-gray-600'>
            <%= @restaurant.start_time.strftime('%R')%> - 
            <%= @restaurant.end_time.strftime('%R')%>
          </p>
        </div>
        <div class='pb-2 mb-2 border-b-2'>
          <p class='mb-2'>料理類型</p>
        </div>
      </div>
    </div>
   
  </section>
 
  
  <section>
    <div class="py-8 space-y-2.5 border-b-2" data-controller="swiper-carousel">
      <div style="display: flex; justify-content:center; align-items: center" >
        <div class="swiper mySwiper">
          <div class="swiper-wrapper">
            <% @restaurant.images.each do |image| %>
              <div class="swiper-slide">
                <%= image_tag (image.url), class:"object-cover" %>
              </div>
            <% end %>
          </div>
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-pagination"></div>
        </div>
      </div>
    </div>
  </section>

  <section>
    <div class="py-8 space-y-2.5 border-b-2">
      <div class="grid grid-cols-1 gap-4 p-4 border rounded-lg shadow-lg">
        <div class="flex gap-4">
          <div class="flex flex-col w-full -mb-4">
            <h2 class="text-gray-800">陳大東／2022-10-21</h2>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          </div>
        </div>
        <p class="text-gray-500">Lorem ipsum dolor sit amet consectetur adipisicing elit. <br>Maxime quisquam vero adipisci beatae voluptas dolor ame.</p>
      </div>
    </div>
  </section>
  
  <section>
    <div class="py-8 space-y-2.5 border-b-2 grid grid-cols-2">
      <form class="p-4 border rounded-lg shadow-lg">
        <div class="flex flex-wrap mb-6 -mx-3">
          <h2 class="px-4 pt-3 pb-2 text-lg text-gray-800">我有話要說</h2>
          <div class="w-full px-3 mt-2 mb-2">
            <input class="h-10 px-3 input-border-click" type="text" placeholder='請輸入標題'>
          </div>
          <div class="w-full px-3 mt-2 mb-2">
            <textarea class="w-full h-20 px-3 py-2 resize-none input-border-click " name="comment" placeholder='請輸入留言' required></textarea>
          </div>
          <div class="flex items-start w-full px-3 md:w-full">
            <div>
              <input type='submit' class="px-4 py-1 mr-1 font-medium text-yellow-600 input-border-click hover:bg-yellow-100" value='送出留言'>
            </div>
          </div>
        </div>
      </form>
    </div>
  </section>
</main>